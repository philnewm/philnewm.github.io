{"version": "https://jsonfeed.org/version/1", "title": "Phils Blog", "home_page_url": "https://philnewm.github.io/", "feed_url": "https://philnewm.github.io/feed_json_updated.json", "description": "A blog for my personal development projects", "icon": "https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Feed-icon.svg/128px-Feed-icon.svg.png", "authors": [], "language": "en", "items": [{"id": "https://philnewm.github.io/ansible_molecule_using_vagrant_and_virtualbox/", "url": "https://philnewm.github.io/ansible_molecule_using_vagrant_and_virtualbox/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication", "title": "Getting started with Ansible Molecule", "content_html": "<h1 id=\"getting-started-with-ansible-molecule\">Getting started with Ansible Molecule</h1>\n<h2 id=\"intro\">Intro</h2>\n<hr />\n<p>After reading through a bunch of Ansible molecule setup guides I noticed quite a bunch of them were outdated in at least one critical aspect. Will discuss the details of this in <a href=\"#prepare-development-environment\">Prepare development environment</a>.\n@@TODO make inline markdown style links work in obsidian.</p>\n<p>So this is a guide on setting up Ansible Molecule for testing Ansible roles by running them against virtual machines. These virtual machines will be controlled by Vagrant using VirtualBox as provider.\nThe code in this guide was developed and tested on AlmaLinux9 and Ubuntu22.04 for the software versions mentioned in <a href=\"#requirements\">Requirements</a></p>\n<p>@@TODO figure out rules for separator placement</p>\n<h2 id=\"requirements\">Requirements</h2>\n<hr />\n<h3 id=\"system\">System</h3>\n<p>Since we will use VirtualBox virtual Machines in this guide it's required for you system to have virtualization enabled in your Mainboards BIOS or UEFI.\nCheck this <a href=\"https://helpdeskgeek.com/how-to/how-to-enable-virtualization-in-bios-for-intel-and-amd/\">article</a> for further details</p>\n<p>This guide is intended to be followed on a Linux system.\nThis articles assumes you got a basic understanding of Ansible and how to operate within the Linux terminal.\nTo follow this <a href=\"https://ultahost.com/knowledge-base/install-ansible-on-windows/\">guide on a Windows system</a> you will need to use the Windows Subsystem for Linux (WSL) since Ansible is not supported on Windows.\nIt does however support remote controlling <a href=\"https://docs.ansible.com/ansible/latest/os_guide/intro_windows.html\">Windows hosts</a>.</p>\n<h3 id=\"python\">Python</h3>\n<p>You will need python &gt;= 3.10 to install the latest versions of all required python packages.\nAdditional the python-venv and python-pip package will be required.\nHere just the example install command for Ubuntu22.04\n<code>sudo apt-get install python3.12 python3.12-venv python3-pip</code></p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Creating a <a href=\"https://realpython.com/python-virtual-environments-a-primer/\">python virtual environment</a> for Ansible first is highly recommended.</p>\n</div>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>python<span class=\"si\">${</span><span class=\"p\">{ env.PYTHON_VERSION </span><span class=\"si\">}</span><span class=\"o\">}</span><span class=\"w\"> </span>-m<span class=\"w\"> </span>venv<span class=\"w\"> </span>~/.venv/ansible_env\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"nb\">source</span><span class=\"w\"> </span>~/.venv/ansible_env/bin/activate\n</span></code></pre></div>\n<p>Next we need a bunch of python packages like Ansible, Molecule and its Vagrant plugin.</p>\n<p>Create a project directory and <code>cd</code> into it.\nCreate a <code>requirements.txt</code> file containing these lines:</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"nv\">ansible</span><span class=\"o\">==</span><span class=\"m\">10</span>.6.0\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"nv\">molecule</span><span class=\"o\">==</span><span class=\"m\">24</span>.9.0\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a>molecule-plugins<span class=\"o\">[</span>vagrant<span class=\"o\">]</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"nv\">docker</span><span class=\"o\">==</span><span class=\"m\">7</span>.1.0\n</span></code></pre></div>\n<details class=\"tip\">\n<summary>docker python packages</summary>\n<p>Installing the docker python package is only necessary due to a bug <a href=\"https://github.com/ansible/molecule/issues/2540\">#32540</a> in molecule plugins.\nA fix for this one is already merged, see <a href=\"https://github.com/ansible-community/molecule-plugins/issues/166\">#166</a> but no new release happened so far.</p>\n</details>\n<p>Now you can run upgrade pip (just to be sure) and install the requirements.</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>--upgrade<span class=\"w\"> </span>pip\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>-r<span class=\"w\"> </span>requirements.txt\n</span></code></pre></div>\n<h3 id=\"tools\">Tools</h3>\n<p>As the title suggests you also need Virtualbox and Vagrant installed to follow along.</p>\n<p><strong>Vagrant</strong> is a virtual machine management tool which allows molecule to create, start and remove virtual machines in an automated way.\n<strong>VirtualBox</strong> on the other hand is the virtualization provider and handles all the heavy lifting when it comes to virtualizing your hardware.\nSee the following table for download pages and version used for the following examples.</p>\n<table>\n<thead>\n<tr>\n<th>Tool</th>\n<th>Download Page</th>\n<th>Version used here</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Virtualbox</td>\n<td><a href=\"https://www.virtualbox.org/wiki/Downloads\">Installers</a></td>\n<td>7.1.4</td>\n</tr>\n<tr>\n<td>Vagrant</td>\n<td><a href=\"https://developer.hashicorp.com/vagrant/install\">Install commands</a></td>\n<td>2.4.3</td>\n</tr>\n</tbody>\n</table>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>wget<span class=\"w\"> </span>-O-<span class=\"w\"> </span>https://apt.releases.hashicorp.com/gpg<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>sudo<span class=\"w\"> </span>gpg<span class=\"w\"> </span>--dearmor<span class=\"w\"> </span>-o<span class=\"w\"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class=\"k\">$(</span>lsb_release<span class=\"w\"> </span>-cs<span class=\"k\">)</span><span class=\"s2\"> main&quot;</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>sudo<span class=\"w\"> </span>tee<span class=\"w\"> </span>/etc/apt/sources.list.d/hashicorp.list\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>update\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>install<span class=\"w\"> </span>vagrant<span class=\"w\"> </span>-y\n</span></code></pre></div>\n<p>It seems like the install command on the VirtualBox website for RedHat based system got a typo in it - at least I needed to change it to the one below to make it work.</p>\n<div class=\"tabbed-set tabbed-alternate\" data-tabs=\"1:2\"><input checked=\"checked\" id=\"__tabbed_1_1\" name=\"__tabbed_1\" type=\"radio\" /><input id=\"__tabbed_1_2\" name=\"__tabbed_1\" type=\"radio\" /><div class=\"tabbed-labels\"><label for=\"__tabbed_1_1\">apt-get</label><label for=\"__tabbed_1_2\">dnf</label></div>\n<div class=\"tabbed-content\">\n<div class=\"tabbed-block\">\n<div class=\"language-bash highlight\"><table class=\"highlighttable\"><tr><th colspan=\"2\" class=\"filename\"><span class=\"filename\">Install on Debian-based systems</span></th></tr><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-4-1\">1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-2\">2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-3\">3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-4\">4</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\"></a>sudo<span class=\"w\"> </span>sh<span class=\"w\"> </span>-c<span class=\"w\"> </span><span class=\"s1\">&#39;echo &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian $(lsb_release -sc) contrib&quot; &gt;&gt; /etc/apt/sources.list&#39;</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\"></a>wget<span class=\"w\"> </span>-O-<span class=\"w\"> </span>https://www.virtualbox.org/download/oracle_vbox_2016.asc<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>sudo<span class=\"w\"> </span>gpg<span class=\"w\"> </span>--yes<span class=\"w\"> </span>--output<span class=\"w\"> </span>/usr/share/keyrings/oracle-virtualbox-2016.gpg<span class=\"w\"> </span>--dearmor\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>update\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\"></a>sudo<span class=\"w\"> </span>apt-get<span class=\"w\"> </span>install<span class=\"w\"> </span>virtualbox-7.1<span class=\"w\"> </span>-y\n</span></code></pre></div></td></tr></table></div>\n</div>\n<div class=\"tabbed-block\">\n<div class=\"language-bash highlight\"><table class=\"highlighttable\"><tr><th colspan=\"2\" class=\"filename\"><span class=\"filename\">Install on RedHat-based systems</span></th></tr><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-5-1\">1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-2\">2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-3\">3</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\"></a>wget<span class=\"w\"> </span>-q<span class=\"w\"> </span>https://www.virtualbox.org/download/oracle_vbox_2016.asc<span class=\"w\"> </span>-O-<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>rpm<span class=\"w\"> </span>--import<span class=\"w\"> </span>oracle_vbox_2016.asc\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\"></a>sudo<span class=\"w\"> </span>dnf<span class=\"w\"> </span>update\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\"></a>sudo<span class=\"w\"> </span>dnf<span class=\"w\"> </span>install<span class=\"w\"> </span>virtualbox-7.1<span class=\"w\"> </span>-y\n</span></code></pre></div></td></tr></table></div>\n</div>\n</div>\n</div>\n<p>Verify the successful installation of both tools by checking their version.</p>\n<div class=\"language-bash highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-6-1\">1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-6-2\">2</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\"></a>VBoxManage<span class=\"w\"> </span>--version\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\"></a>vagrant<span class=\"w\"> </span>--version\n</span></code></pre></div></td></tr></table></div>\n<h2 id=\"prepare-development-environment\">Prepare development environment</h2>\n<hr />\n<p>While I was trying to understand molecule I came across many guides mentioning the command <code>molecule role init</code>.\nThis one doesn't exist anymore since version <a href=\"https://github.com/ansible/molecule/releases/tag/v6.0.0\">6.0.0</a> - it was removed intentional to get rid of the <a href=\"https://github.com/ansible/galaxy\">Ansible-Galaxy</a> dependency. By now you simply use the <code>role init</code> command to initialize an Ansible role and initialize a molecule scenario from within the role afterwards.</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>ansible-galaxy<span class=\"w\"> </span>role<span class=\"w\"> </span>init<span class=\"w\"> </span>example\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>example\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a>molecule<span class=\"w\"> </span>init<span class=\"w\"> </span>scenario\n</span></code></pre></div>\n<p>For now we'll just go with the <em>default</em> scenario to keep it simple.\nNow you got a \"molecule\" directory inside the role containing a bunch of default .yml files.</p>\n<div class=\"language-text highlight\"><span class=\"filename\">Role Structure</span><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a>\ud83d\udce6sample_role\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a> \u2523 \ud83d\udcc2defaults\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a> \u2503 \u2517 \ud83d\udcdcmain.yml\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a> \u2523 \ud83d\udcc2files\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a> \u2523 \ud83d\udcc2handlers\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a> \u2503 \u2517 \ud83d\udcdcmain.yml\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a> \u2523 \ud83d\udcc2meta\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a> \u2503 \u2517 \ud83d\udcdcmain.yml\n</span><span id=\"__span-8-9\"><a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a> \u2523 \ud83d\udcc2molecule\n</span><span id=\"__span-8-10\"><a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a> \u2503 \u2517 \ud83d\udcc2default\n</span><span id=\"__span-8-11\"><a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a> \u2503   \u2523 \ud83d\udcdcconverge.yml\n</span><span id=\"__span-8-12\"><a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a> \u2503   \u2523 \ud83d\udcdccreate.yml\n</span><span id=\"__span-8-13\"><a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a> \u2503   \u2523 \ud83d\udcdcdestroy.yml\n</span><span id=\"__span-8-14\"><a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a> \u2503   \u2517 \ud83d\udcdcmolecule.yml\n</span><span id=\"__span-8-15\"><a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a> \u2523 \ud83d\udcc2tasks\n</span><span id=\"__span-8-16\"><a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a> \u2503 \u2517 \ud83d\udcdcmain.yml\n</span><span id=\"__span-8-17\"><a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a> \u2523 \ud83d\udcc2templates\n</span><span id=\"__span-8-18\"><a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a> \u2523 \ud83d\udcc2tests\n</span><span id=\"__span-8-19\"><a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a> \u2503 \u2523 \ud83d\udcdcinventory\n</span><span id=\"__span-8-20\"><a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a> \u2503 \u2517 \ud83d\udcdctest.yml\n</span><span id=\"__span-8-21\"><a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a> \u2523 \ud83d\udcc2vars\n</span><span id=\"__span-8-22\"><a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a> \u2503 \u2517 \ud83d\udcdcmain.yml\n</span><span id=\"__span-8-23\"><a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a> \u2517 \ud83d\udcdcREADME.md\n</span></code></pre></div>\n<p>For details about how each file and directory inside this role structure is supposed to be used see the <a href=\"https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html#role-directory-structure\">Ansible documentation</a></p>\n<h2 id=\"instance-creation\">Instance Creation</h2>\n<hr />\n<h3 id=\"default-instance\">Default Instance</h3>\n<p>Creating a molecule instance is done by running <code>molecule create</code> if you do that right away from the roles root directory you will most likely encounter the following error:</p>\n<div class=\"language-text highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>ERROR    Computed fully qualified role name of sample does not follow current galaxy requirements.\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a>Please edit meta/main.yml and assure we can correctly determine full role name:\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a>\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a>galaxy_info:\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a>role_name: my_name  # if absent directory name hosting role is used instead\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a>namespace: my_galaxy_namespace  # if absent, author is used instead\n</span></code></pre></div>\n<p>This happens due to molecule running a <a href=\"https://ansible.readthedocs.io/projects/molecule/configuration/#role-name-check\">role name-check</a> by default.\nAs stated in the documentation you can either disable the check or just add the <code>role_name</code> and <code>namespace</code> to the <code>meta/main.yml</code> file.</p>\n<p>Now running <code>molecule create</code> should, while throwing a bunch of warnings, already work.\nRunning <code>molecule list</code> should now show this table.</p>\n<table>\n<thead>\n<tr>\n<th>Instance Name</th>\n<th>Driver Name</th>\n<th>Provisioner Name</th>\n<th>Scenario Name</th>\n<th>Created</th>\n<th>Converged</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>instance</td>\n<td>default</td>\n<td>ansible</td>\n<td>default</td>\n<td>true</td>\n<td>false</td>\n</tr>\n</tbody>\n</table>\n<p>This will create a default instance using the <a href=\"https://ansible.readthedocs.io/projects/molecule/configuration/#delegated\">delegated driver</a>, which is just called \"default\".\nAs the title suggests we will use Vagrant as driver with VirtualBox as a provider in this example.\nSo run <code>molecule destroy</code> to remove that default instance again.\nIf you run <code>molecule drivers</code> you should see a list of installed drivers including <code>vagrant</code>.\nTake a look at the <a href=\"https://github.com/ansible-community/molecule-plugins/blob/main/README.md\">molecule-plugins repository</a> for additional information</p>\n<h3 id=\"cleaning-up\">Cleaning up</h3>\n<p>Molecule stores all instance related data in a so called <em>ephermal directory</em> and removes it when running <code>molecule reset</code>.\nIt's placed at <code>~/.cache/molecule/&lt;role-name&gt;/&lt;scenario-name&gt;</code> by default and usually gets displayed during instance creation @@TODO check instance creation output. \nRunning <code>molecule reset</code> might result in a python-traceback related to docker on RHEL-systems but will still work and remove the directory as expected.</p>\n<details class=\"warning\">\n<summary>Python traceback explanation for <code>molecule reset</code></summary>\n<p>Indicates docker and or the python module isn't installed on your system, see <a href=\"https://github.com/ansible-community/molecule-plugins/issues/166\">#166</a>\nHappens e.g. on Almalinux 9 due to podman being the default container service instead of docker and molecule doesn't seem to like this.</p>\n</details>\n<h3 id=\"vagrant-instance\">Vagrant Instance</h3>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"nn\">---</span>\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a>\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"nt\">driver</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">  </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">vagrant</span>\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"w\">  </span><span class=\"nt\">provider</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"w\">    </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">virtualbox</span>\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"nt\">platforms</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">  </span><span class=\"c1\"># Defaults to Alpine Linux in case no box details are provided</span>\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Alma9</span>\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"w\">    </span><span class=\"nt\">box</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">almalinux/9</span>\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">    </span><span class=\"nt\">box_version</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;9.5.20241203&quot;</span>\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a><span class=\"w\">    </span><span class=\"nt\">memory</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">2048</span>\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">    </span><span class=\"nt\">cpus</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">2</span>\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">    </span><span class=\"nt\">interfaces</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-15\"><a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">auto_config</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-10-16\"><a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a><span class=\"w\">        </span><span class=\"nt\">network_name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">private_network</span>\n</span><span id=\"__span-10-17\"><a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\">        </span><span class=\"nt\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;static&quot;</span>\n</span><span id=\"__span-10-18\"><a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">        </span><span class=\"nt\">ip</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;192.168.56.10&quot;</span>\n</span><span id=\"__span-10-19\"><a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"nt\">provisioner</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-20\"><a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a><span class=\"w\">  </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ansible</span>\n</span><span id=\"__span-10-21\"><a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">  </span><span class=\"nt\">config_options</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-22\"><a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\" href=\"#__codelineno-10-22\"></a><span class=\"w\">    </span><span class=\"nt\">defaults</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-23\"><a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\" href=\"#__codelineno-10-23\"></a><span class=\"w\">      </span><span class=\"nt\">stdout_callback</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">debug</span>\n</span><span id=\"__span-10-24\"><a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\" href=\"#__codelineno-10-24\"></a><span class=\"w\">      </span><span class=\"nt\">callbacks_enabled</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ansible.posix.profile_tasks</span>\n</span><span id=\"__span-10-25\"><a id=\"__codelineno-10-25\" name=\"__codelineno-10-25\" href=\"#__codelineno-10-25\"></a><span class=\"w\">    </span><span class=\"nt\">env</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-26\"><a id=\"__codelineno-10-26\" name=\"__codelineno-10-26\" href=\"#__codelineno-10-26\"></a><span class=\"w\">      </span><span class=\"nt\">ANSIBLE_FORCE_COLOR</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;true&quot;</span>\n</span><span id=\"__span-10-27\"><a id=\"__codelineno-10-27\" name=\"__codelineno-10-27\" href=\"#__codelineno-10-27\"></a><span class=\"nt\">verifier</span><span class=\"p\">:</span>\n</span><span id=\"__span-10-28\"><a id=\"__codelineno-10-28\" name=\"__codelineno-10-28\" href=\"#__codelineno-10-28\"></a><span class=\"w\">  </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ansible</span>\n</span><span id=\"__span-10-29\"><a id=\"__codelineno-10-29\" name=\"__codelineno-10-29\" href=\"#__codelineno-10-29\"></a><span class=\"w\">  </span><span class=\"nt\">enabled</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">True</span>\n</span><span id=\"__span-10-30\"><a id=\"__codelineno-10-30\" name=\"__codelineno-10-30\" href=\"#__codelineno-10-30\"></a>\n</span><span id=\"__span-10-31\"><a id=\"__codelineno-10-31\" name=\"__codelineno-10-31\" href=\"#__codelineno-10-31\"></a><span class=\"nn\">...</span>\n</span></code></pre></div>\n<p>You can find some explanation of all these settings in the <a href=\"https://ansible.readthedocs.io/projects/molecule/getting-started/#inspecting-the-moleculeyml\">Ansible molecule docs</a></p>\n<details class=\"info\">\n<summary>VirtualBox Network Setup</summary>\n<p>Assigning a network-interface using a <code>192.168.56.X</code> address is crucial here.\nVirtualBox sets up two virtual networks  by default.</p>\n<ul>\n<li>vboxnet0 - which is Host-only using 192.168.56.1</li>\n<li>NatNetwork - using 10.0.2.X</li>\n</ul>\n<p>NatNetwork will be used by default but requires port forwarding from the host to the VM to make it accessible from e.g. a browser on the host\nTo get around this we just assign a static address from the host-only network.</p>\n</details>\n<div class=\"language-shell highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a>molecule<span class=\"w\"> </span>init<span class=\"w\"> </span>scenario<span class=\"w\"> </span>default<span class=\"w\"> </span>--driver-name<span class=\"w\"> </span>vagrant<span class=\"w\"> </span>--provisioner-name<span class=\"w\"> </span>ansible\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a>cp<span class=\"w\"> </span>~/.venv/ansible_env/lib/python<span class=\"si\">${</span><span class=\"p\">{ env.PYTHON_VERSION </span><span class=\"si\">}</span><span class=\"o\">}</span>/site-packages/molecule_plugins/vagrant/playbooks/create.yml<span class=\"w\"> </span>molecule/default/create.yml\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a>cp<span class=\"w\"> </span>~/.venv/ansible_env/lib/python<span class=\"si\">${</span><span class=\"p\">{ env.PYTHON_VERSION </span><span class=\"si\">}</span><span class=\"o\">}</span>/site-packages/molecule_plugins/vagrant/playbooks/destroy.yml<span class=\"w\"> </span>molecule/default/destroy.yml\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a>mv<span class=\"w\"> </span>requirements.yml<span class=\"w\"> </span>molecule/default/requirements.yml\n</span><span id=\"__span-11-5\"><a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a>mv<span class=\"w\"> </span>molecule.yml<span class=\"w\"> </span>molecule/default/molecule.yml\n</span><span id=\"__span-11-6\"><a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a>mv<span class=\"w\"> </span>converge.yml<span class=\"w\"> </span>molecule/default/converge.yml\n</span><span id=\"__span-11-7\"><a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a>mv<span class=\"w\"> </span>verify.yml<span class=\"w\"> </span>molecule/default/verify.yml\n</span></code></pre></div>\n<p>@@ TODO research line number referencing in Ansible books\nLine 1: Initialize a new scenario using explicit parameters to use vagrant\nLine 2: The default <code>create.yml</code> file will cause connection issues on start-up so we fix this by copying the one from the molecule vagrant plugin itself\nLine 3: The default <code>destroy.yml</code>file won't destroy the vagrant box itself so we replace it by copying the one from the molecule vagrant plugin itself\nLine 4: @@TODO try to get rid of this line - requires removing debug formatting from molecule.yml\nLine 5: Now replace the molecule config file <code>molecule/default/molecule.yml</code> with the provided one which uses AlmaLinux9. - Get other vagrant boxes on <a href=\"https://portal.cloud.hashicorp.com/vagrant/discover/almalinux/9\">vagrant cloud</a>\nLine 6: Same goes for the <code>converge.yml</code> playbook\nLine 7: Same goes for the <code>verify.yml</code> playbook</p>\n<p>Running <code>molecule create</code> and <code>molecule list</code> when it's done should now display a vagrant instance.</p>\n<h3 id=\"access-vagrant-instance\">Access Vagrant Instance</h3>\n<p>Accessing an instance is supposed to be done by running <code>molecule login</code>, this is currently not working due to a <a href=\"https://github.com/ansible-community/molecule-plugins/issues/239\">bug</a> and should be resolved with the next release.\nIn the meantime you can run <code>vagrant global-status</code> to get the vagrant instance IDs and <code>vagrant ssh &lt;id&gt;</code> to log into one of the VMs displayed. Afterwards just type <code>exit</code> to drop out of the instance again.</p>\n<h2 id=\"provision-a-service\">Provision a service</h2>\n<hr />\n<p>After setting up this vagrant instance successfully it is now time to make it do something using Ansible as its provisioner. We will use these tasks so set up an Apache web-server.\nThis is just a very basic example for demonstration.</p>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-12-1\"><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a><span class=\"nn\">---</span>\n</span><span id=\"__span-12-2\"><a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a>\n</span><span id=\"__span-12-3\"><a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Gather facts</span>\n</span><span id=\"__span-12-4\"><a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.gather_facts</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-5\"><a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a>\n</span><span id=\"__span-12-6\"><a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Install Apache web server</span>\n</span><span id=\"__span-12-7\"><a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a><span class=\"w\">  </span><span class=\"nt\">become</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-12-8\"><a id=\"__codelineno-12-8\" name=\"__codelineno-12-8\" href=\"#__codelineno-12-8\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.package</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-9\"><a id=\"__codelineno-12-9\" name=\"__codelineno-12-9\" href=\"#__codelineno-12-9\"></a><span class=\"w\">    </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">httpd</span>\n</span><span id=\"__span-12-10\"><a id=\"__codelineno-12-10\" name=\"__codelineno-12-10\" href=\"#__codelineno-12-10\"></a><span class=\"w\">    </span><span class=\"nt\">state</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">present</span>\n</span><span id=\"__span-12-11\"><a id=\"__codelineno-12-11\" name=\"__codelineno-12-11\" href=\"#__codelineno-12-11\"></a>\n</span><span id=\"__span-12-12\"><a id=\"__codelineno-12-12\" name=\"__codelineno-12-12\" href=\"#__codelineno-12-12\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Ensure Apache is started and enabled on boot</span>\n</span><span id=\"__span-12-13\"><a id=\"__codelineno-12-13\" name=\"__codelineno-12-13\" href=\"#__codelineno-12-13\"></a><span class=\"w\">  </span><span class=\"nt\">become</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-12-14\"><a id=\"__codelineno-12-14\" name=\"__codelineno-12-14\" href=\"#__codelineno-12-14\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.service</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-15\"><a id=\"__codelineno-12-15\" name=\"__codelineno-12-15\" href=\"#__codelineno-12-15\"></a><span class=\"w\">    </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;httpd&quot;</span>\n</span><span id=\"__span-12-16\"><a id=\"__codelineno-12-16\" name=\"__codelineno-12-16\" href=\"#__codelineno-12-16\"></a><span class=\"w\">    </span><span class=\"nt\">state</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;started&quot;</span>\n</span><span id=\"__span-12-17\"><a id=\"__codelineno-12-17\" name=\"__codelineno-12-17\" href=\"#__codelineno-12-17\"></a><span class=\"w\">    </span><span class=\"nt\">enabled</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-12-18\"><a id=\"__codelineno-12-18\" name=\"__codelineno-12-18\" href=\"#__codelineno-12-18\"></a>\n</span><span id=\"__span-12-19\"><a id=\"__codelineno-12-19\" name=\"__codelineno-12-19\" href=\"#__codelineno-12-19\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Create default index.html</span>\n</span><span id=\"__span-12-20\"><a id=\"__codelineno-12-20\" name=\"__codelineno-12-20\" href=\"#__codelineno-12-20\"></a><span class=\"w\">  </span><span class=\"nt\">become</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-12-21\"><a id=\"__codelineno-12-21\" name=\"__codelineno-12-21\" href=\"#__codelineno-12-21\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.copy</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-22\"><a id=\"__codelineno-12-22\" name=\"__codelineno-12-22\" href=\"#__codelineno-12-22\"></a><span class=\"w\">    </span><span class=\"nt\">content</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span>\n</span><span id=\"__span-12-23\"><a id=\"__codelineno-12-23\" name=\"__codelineno-12-23\" href=\"#__codelineno-12-23\"></a><span class=\"w\">      </span><span class=\"no\">&lt;html&gt;</span>\n</span><span id=\"__span-12-24\"><a id=\"__codelineno-12-24\" name=\"__codelineno-12-24\" href=\"#__codelineno-12-24\"></a><span class=\"w\">      </span><span class=\"no\">&lt;body&gt;</span>\n</span><span id=\"__span-12-25\"><a id=\"__codelineno-12-25\" name=\"__codelineno-12-25\" href=\"#__codelineno-12-25\"></a><span class=\"w\">        </span><span class=\"no\">&lt;h1&gt;Welcome to Apache on AlmaLinux!&lt;/h1&gt;</span>\n</span><span id=\"__span-12-26\"><a id=\"__codelineno-12-26\" name=\"__codelineno-12-26\" href=\"#__codelineno-12-26\"></a><span class=\"w\">      </span><span class=\"no\">&lt;/body&gt;</span>\n</span><span id=\"__span-12-27\"><a id=\"__codelineno-12-27\" name=\"__codelineno-12-27\" href=\"#__codelineno-12-27\"></a><span class=\"w\">      </span><span class=\"no\">&lt;/html&gt;</span>\n</span><span id=\"__span-12-28\"><a id=\"__codelineno-12-28\" name=\"__codelineno-12-28\" href=\"#__codelineno-12-28\"></a><span class=\"w\">    </span><span class=\"nt\">dest</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">/var/www/html/index.html</span>\n</span><span id=\"__span-12-29\"><a id=\"__codelineno-12-29\" name=\"__codelineno-12-29\" href=\"#__codelineno-12-29\"></a><span class=\"w\">    </span><span class=\"nt\">owner</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">root</span>\n</span><span id=\"__span-12-30\"><a id=\"__codelineno-12-30\" name=\"__codelineno-12-30\" href=\"#__codelineno-12-30\"></a><span class=\"w\">    </span><span class=\"nt\">group</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">root</span>\n</span><span id=\"__span-12-31\"><a id=\"__codelineno-12-31\" name=\"__codelineno-12-31\" href=\"#__codelineno-12-31\"></a><span class=\"w\">    </span><span class=\"nt\">mode</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&#39;0644&#39;</span>\n</span><span id=\"__span-12-32\"><a id=\"__codelineno-12-32\" name=\"__codelineno-12-32\" href=\"#__codelineno-12-32\"></a><span class=\"w\">  </span><span class=\"nt\">register</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">default_page</span>\n</span><span id=\"__span-12-33\"><a id=\"__codelineno-12-33\" name=\"__codelineno-12-33\" href=\"#__codelineno-12-33\"></a>\n</span><span id=\"__span-12-34\"><a id=\"__codelineno-12-34\" name=\"__codelineno-12-34\" href=\"#__codelineno-12-34\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Restart Apache service</span>\n</span><span id=\"__span-12-35\"><a id=\"__codelineno-12-35\" name=\"__codelineno-12-35\" href=\"#__codelineno-12-35\"></a><span class=\"w\">  </span><span class=\"nt\">become</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-12-36\"><a id=\"__codelineno-12-36\" name=\"__codelineno-12-36\" href=\"#__codelineno-12-36\"></a><span class=\"w\">  </span><span class=\"nt\">when</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">default_page.changed</span>\n</span><span id=\"__span-12-37\"><a id=\"__codelineno-12-37\" name=\"__codelineno-12-37\" href=\"#__codelineno-12-37\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.service</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-38\"><a id=\"__codelineno-12-38\" name=\"__codelineno-12-38\" href=\"#__codelineno-12-38\"></a><span class=\"w\">    </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">httpd</span>\n</span><span id=\"__span-12-39\"><a id=\"__codelineno-12-39\" name=\"__codelineno-12-39\" href=\"#__codelineno-12-39\"></a><span class=\"w\">    </span><span class=\"nt\">state</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">restarted</span>\n</span><span id=\"__span-12-40\"><a id=\"__codelineno-12-40\" name=\"__codelineno-12-40\" href=\"#__codelineno-12-40\"></a>\n</span><span id=\"__span-12-41\"><a id=\"__codelineno-12-41\" name=\"__codelineno-12-41\" href=\"#__codelineno-12-41\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Display VM IP address</span>\n</span><span id=\"__span-12-42\"><a id=\"__codelineno-12-42\" name=\"__codelineno-12-42\" href=\"#__codelineno-12-42\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.debug</span><span class=\"p\">:</span>\n</span><span id=\"__span-12-43\"><a id=\"__codelineno-12-43\" name=\"__codelineno-12-43\" href=\"#__codelineno-12-43\"></a><span class=\"w\">    </span><span class=\"nt\">var</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ansible_all_ipv4_addresses</span>\n</span><span id=\"__span-12-44\"><a id=\"__codelineno-12-44\" name=\"__codelineno-12-44\" href=\"#__codelineno-12-44\"></a>\n</span><span id=\"__span-12-45\"><a id=\"__codelineno-12-45\" name=\"__codelineno-12-45\" href=\"#__codelineno-12-45\"></a><span class=\"nn\">...</span>\n</span></code></pre></div>\n<p>Now replace the content of <code>tasks/main.yml</code> with these yaml tasks.</p>\n<p>Next run <code>molecule converge</code> to run these tasks against the VirtualBox VM.\nAfter this ran successfully you should be able to just copy the IP address displayed by the debug task e.g. <code>192.168.56.10</code> to your browser and see the default Apache web-server page right away.</p>\n<p>Even tho this is nice, testing the functionality of this web-server manually isn't quite a scalable approach. It's time to set up automated testing for this role.</p>\n<h2 id=\"test-vagrant-instance\">Test Vagrant Instance</h2>\n<hr />\n<p>We will use <a href=\"https://ansible.readthedocs.io/projects/molecule/configuration/?h=#molecule.verifier.ansible.Ansible\">Ansible for testing</a> as well to stay with the default and to keep it simple. Another popular option for molecule testing is <a href=\"https://ansible.readthedocs.io/projects/molecule/configuration/?h=#molecule.verifier.testinfra.Testinfra\">testinfra</a>\nTake a look now at these test tasks which should be self-explanatory due to their names.</p>\n<div class=\"language-yaml highlight\"><pre><span></span><code><span id=\"__span-13-1\"><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\" href=\"#__codelineno-13-1\"></a><span class=\"nn\">---</span>\n</span><span id=\"__span-13-2\"><a id=\"__codelineno-13-2\" name=\"__codelineno-13-2\" href=\"#__codelineno-13-2\"></a>\n</span><span id=\"__span-13-3\"><a id=\"__codelineno-13-3\" name=\"__codelineno-13-3\" href=\"#__codelineno-13-3\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Gather package facts</span>\n</span><span id=\"__span-13-4\"><a id=\"__codelineno-13-4\" name=\"__codelineno-13-4\" href=\"#__codelineno-13-4\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.package_facts</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-5\"><a id=\"__codelineno-13-5\" name=\"__codelineno-13-5\" href=\"#__codelineno-13-5\"></a>\n</span><span id=\"__span-13-6\"><a id=\"__codelineno-13-6\" name=\"__codelineno-13-6\" href=\"#__codelineno-13-6\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Gather service facts</span>\n</span><span id=\"__span-13-7\"><a id=\"__codelineno-13-7\" name=\"__codelineno-13-7\" href=\"#__codelineno-13-7\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.service_facts</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-8\"><a id=\"__codelineno-13-8\" name=\"__codelineno-13-8\" href=\"#__codelineno-13-8\"></a>\n</span><span id=\"__span-13-9\"><a id=\"__codelineno-13-9\" name=\"__codelineno-13-9\" href=\"#__codelineno-13-9\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Test Apache package is installed</span>\n</span><span id=\"__span-13-10\"><a id=\"__codelineno-13-10\" name=\"__codelineno-13-10\" href=\"#__codelineno-13-10\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.assert</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-11\"><a id=\"__codelineno-13-11\" name=\"__codelineno-13-11\" href=\"#__codelineno-13-11\"></a><span class=\"w\">    </span><span class=\"nt\">that</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-12\"><a id=\"__codelineno-13-12\" name=\"__codelineno-13-12\" href=\"#__codelineno-13-12\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"s\">&quot;&#39;httpd&#39;</span><span class=\"nv\"> </span><span class=\"s\">in</span><span class=\"nv\"> </span><span class=\"s\">ansible_facts.packages&quot;</span>\n</span><span id=\"__span-13-13\"><a id=\"__codelineno-13-13\" name=\"__codelineno-13-13\" href=\"#__codelineno-13-13\"></a><span class=\"w\">    </span><span class=\"nt\">fail_msg</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;Apache</span><span class=\"nv\"> </span><span class=\"s\">package</span><span class=\"nv\"> </span><span class=\"s\">&#39;httpd&#39;</span><span class=\"nv\"> </span><span class=\"s\">is</span><span class=\"nv\"> </span><span class=\"s\">not</span><span class=\"nv\"> </span><span class=\"s\">installed&quot;</span>\n</span><span id=\"__span-13-14\"><a id=\"__codelineno-13-14\" name=\"__codelineno-13-14\" href=\"#__codelineno-13-14\"></a><span class=\"w\">    </span><span class=\"nt\">quiet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-13-15\"><a id=\"__codelineno-13-15\" name=\"__codelineno-13-15\" href=\"#__codelineno-13-15\"></a>\n</span><span id=\"__span-13-16\"><a id=\"__codelineno-13-16\" name=\"__codelineno-13-16\" href=\"#__codelineno-13-16\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Test Apache service is running</span>\n</span><span id=\"__span-13-17\"><a id=\"__codelineno-13-17\" name=\"__codelineno-13-17\" href=\"#__codelineno-13-17\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.assert</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-18\"><a id=\"__codelineno-13-18\" name=\"__codelineno-13-18\" href=\"#__codelineno-13-18\"></a><span class=\"w\">    </span><span class=\"nt\">that</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-19\"><a id=\"__codelineno-13-19\" name=\"__codelineno-13-19\" href=\"#__codelineno-13-19\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ansible_facts.services[&#39;httpd.service&#39;].state == &#39;running&#39;</span>\n</span><span id=\"__span-13-20\"><a id=\"__codelineno-13-20\" name=\"__codelineno-13-20\" href=\"#__codelineno-13-20\"></a><span class=\"w\">    </span><span class=\"nt\">fail_msg</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;Apache</span><span class=\"nv\"> </span><span class=\"s\">service</span><span class=\"nv\"> </span><span class=\"s\">is</span><span class=\"nv\"> </span><span class=\"s\">not</span><span class=\"nv\"> </span><span class=\"s\">running&quot;</span>\n</span><span id=\"__span-13-21\"><a id=\"__codelineno-13-21\" name=\"__codelineno-13-21\" href=\"#__codelineno-13-21\"></a><span class=\"w\">    </span><span class=\"nt\">quiet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</span><span id=\"__span-13-22\"><a id=\"__codelineno-13-22\" name=\"__codelineno-13-22\" href=\"#__codelineno-13-22\"></a>\n</span><span id=\"__span-13-23\"><a id=\"__codelineno-13-23\" name=\"__codelineno-13-23\" href=\"#__codelineno-13-23\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Query Apache default web page</span>\n</span><span id=\"__span-13-24\"><a id=\"__codelineno-13-24\" name=\"__codelineno-13-24\" href=\"#__codelineno-13-24\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.uri</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-25\"><a id=\"__codelineno-13-25\" name=\"__codelineno-13-25\" href=\"#__codelineno-13-25\"></a><span class=\"w\">    </span><span class=\"nt\">url</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;http://{{</span><span class=\"nv\"> </span><span class=\"s\">ansible_all_ipv4_addresses[0]</span><span class=\"nv\"> </span><span class=\"s\">}}&quot;</span>\n</span><span id=\"__span-13-26\"><a id=\"__codelineno-13-26\" name=\"__codelineno-13-26\" href=\"#__codelineno-13-26\"></a><span class=\"w\">  </span><span class=\"nt\">register</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">web_check</span>\n</span><span id=\"__span-13-27\"><a id=\"__codelineno-13-27\" name=\"__codelineno-13-27\" href=\"#__codelineno-13-27\"></a>\n</span><span id=\"__span-13-28\"><a id=\"__codelineno-13-28\" name=\"__codelineno-13-28\" href=\"#__codelineno-13-28\"></a><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Test Apache is reachable</span>\n</span><span id=\"__span-13-29\"><a id=\"__codelineno-13-29\" name=\"__codelineno-13-29\" href=\"#__codelineno-13-29\"></a><span class=\"w\">  </span><span class=\"nt\">ansible.builtin.assert</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-30\"><a id=\"__codelineno-13-30\" name=\"__codelineno-13-30\" href=\"#__codelineno-13-30\"></a><span class=\"w\">    </span><span class=\"nt\">that</span><span class=\"p\">:</span>\n</span><span id=\"__span-13-31\"><a id=\"__codelineno-13-31\" name=\"__codelineno-13-31\" href=\"#__codelineno-13-31\"></a><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">web_check.status == 200</span>\n</span><span id=\"__span-13-32\"><a id=\"__codelineno-13-32\" name=\"__codelineno-13-32\" href=\"#__codelineno-13-32\"></a><span class=\"w\">    </span><span class=\"nt\">fail_msg</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;Web</span><span class=\"nv\"> </span><span class=\"s\">server</span><span class=\"nv\"> </span><span class=\"s\">is</span><span class=\"nv\"> </span><span class=\"s\">not</span><span class=\"nv\"> </span><span class=\"s\">reachable</span><span class=\"nv\"> </span><span class=\"s\">or</span><span class=\"nv\"> </span><span class=\"s\">did</span><span class=\"nv\"> </span><span class=\"s\">not</span><span class=\"nv\"> </span><span class=\"s\">return</span><span class=\"nv\"> </span><span class=\"s\">status</span><span class=\"nv\"> </span><span class=\"s\">code</span><span class=\"nv\"> </span><span class=\"s\">200&quot;</span>\n</span><span id=\"__span-13-33\"><a id=\"__codelineno-13-33\" name=\"__codelineno-13-33\" href=\"#__codelineno-13-33\"></a><span class=\"w\">    </span><span class=\"nt\">success_msg</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;Web</span><span class=\"nv\"> </span><span class=\"s\">server</span><span class=\"nv\"> </span><span class=\"s\">is</span><span class=\"nv\"> </span><span class=\"s\">reachable</span><span class=\"nv\"> </span><span class=\"s\">and</span><span class=\"nv\"> </span><span class=\"s\">returned</span><span class=\"nv\"> </span><span class=\"s\">status</span><span class=\"nv\"> </span><span class=\"s\">code</span><span class=\"nv\"> </span><span class=\"s\">200&quot;</span>\n</span><span id=\"__span-13-34\"><a id=\"__codelineno-13-34\" name=\"__codelineno-13-34\" href=\"#__codelineno-13-34\"></a>\n</span><span id=\"__span-13-35\"><a id=\"__codelineno-13-35\" name=\"__codelineno-13-35\" href=\"#__codelineno-13-35\"></a><span class=\"nn\">...</span>\n</span></code></pre></div>\n<p>Place these tasks into a file called <code>tests.yml</code> in the tasks directory to make them easily accessible.\nNow you should be able to run <code>molecule verify</code> to have these tests run against the VM.</p>\n<h2 id=\"vagrant\">Vagrant</h2>\n<p>Explain what gets saved where and how does the ephemeral directory work</p>\n<h2 id=\"wrap-up\">Wrap-Up</h2>\n<hr />", "image": null, "date_modified": "2025-01-22T20:02:00+01:00", "authors": [], "tags": null}, {"id": "https://philnewm.github.io/", "url": "https://philnewm.github.io/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication", "title": "Welcome to MkDocs", "content_html": "<h1 id=\"welcome-to-mkdocs\">Welcome to MkDocs</h1>\n<p>For full documentation visit <a href=\"https://www.mkdocs.org\">mkdocs.org</a>.</p>\n<h2 id=\"commands\">Commands</h2>\n<ul>\n<li><code>mkdocs new [dir-name]</code> - Create a new project.</li>\n<li><code>mkdocs serve</code> - Start the live-reloading docs server.</li>\n<li><code>mkdocs build</code> - Build the documentation site.</li>\n<li><code>mkdocs -h</code> - Print help message and exit.</li>\n</ul>\n<h2 id=\"project-layout\">Project layout</h2>\n<div class=\"language-text highlight\"><pre><span></span><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre></div>", "image": null, "date_modified": "2025-01-19T13:05:17+01:00", "authors": [], "tags": null}]}